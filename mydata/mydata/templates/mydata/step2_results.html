{% extends "base.html" %}
{% load humanize %}
{% block maincontent %}
<a name="top"></a>

<h1>Solr Queries</h1>
<h3>Username: <span style="color:#006699;">{{ username }}</span></h3>

<hr />

<div class="row">
    <form method="get" action="{% url 'view_solr_results' %}">
    <div class="col-md-4">
        <table class="table table-condensed">

            {{ filter_form }}

        </table>
    </div>
    <div class="col-md-6">
        {% if is_valid_form %}
        <p><b>solr_query_from_form:</b>
            <br />{{ filter_form.get_solr_facet_query }}</p>
        <p><b>SQL query1:</b> Direct Assignments
            <br />{{ solr_query1 }}
            <br /></p>

        <p><b>SQL query2:</b> DvObjects from Direct Assignments
            <br />{{ filter_form.get_sql02_direct_assignments }}
            <br /></p>

        <p><b>SQL query3:</b> Indirect Datasets based on Dataverse permissions
            <br />{{ filter_form.get_sql03_indirect_datasets }}
            <br /></p>

        <p><b>SQL query4:</b> Indirect Files
            <br />{{ filter_form.get_sql04_indirect_files }}
            <br /></p>


        {% endif %}
            <hr />
            <input type="reset">
            <input type="submit">
    </div>
    </form>
    <div class="col-md-12">
        <hr /><hr />
    </div>
</div>
<div class="row">
    <div class="col-md-12">

     <p> <b>Count:</b> {{ d2me.all_dataverse_ids|length }}
      <br /> <b>Dataverse ids:</b> {{ d2me.all_dataverse_ids }}
        </p>
     <p><b>solr_helper.solr_fq_query:</b> {{ solr_helper.solr_fq_query }}</p>

    </div>
    <div class="col-md-12">
        <p>num results: {{ solr_results.hits }}</p>
        <p>facets: {{ solr_results.facets }}</p>

        {% for doc in solr_results.docs %}
            {% if doc.dvObjectType == 'dataverses' %}
                <div class="panel panel-default">
                  <div class="panel-heading">{{ doc.name }} (dataverse)</div>
                  <div class="panel-body">
                       {% for publication_status in doc.publicationStatus %}
                        {% include "publication_status.html" %}
                      {% endfor %}
                      <hr />
                      <p><b>dateFriendly:</b> {{ doc.dateFriendly }} - {{ doc.parentName }}</p>
                      <p><b>identifier:</b> {{ doc.identifier }}</p>

                        {{ doc.description }}
                    <hr />{{ doc }}
                  </div>
                </div>
            {% endif %}

            {% if doc.dvObjectType == 'datasets' %}
                <div class="panel panel-default">
                  <div class="panel-heading">{{ doc.title }} (dataset)</div>
                  <div class="panel-body">
                      {% for publication_status in doc.publicationStatus %}
                        {% include "publication_status.html" %}
                      {% endfor %}
                      <hr />

                       <p><b>dateFriendly:</b> {{ doc.dateFriendly }} - {{ doc.parentName }}</p>
                       <p><b>description:</b> {{ doc.dsDescriptionValue.0 }}</p>
                       <p><b>persistent id:</b> {{ doc.dsPersistentId }}</p>
                       <p><b>persistentUrl:</b> <a href="{{ doc.persistentUrl }}">{{ doc.persistentUrl }}</a></p>
                       <p><b>publicationCitation:</b> {{ doc.publicationCitation.0 }}</p>

                    {#{ doc }#}

                  </div>
                </div>
            {% endif %}

        {% endfor %}
    </div>
</div>
{% endblock %}